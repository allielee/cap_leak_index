"0","AKIdevelopmentW['cr7undercreat1']<-AKIdevelopmentW$peakcreat7d/AKIdevelopmentW$creat1"
"0","AKIdevelopmentW['cr48hdundercreat1']<-AKIdevelopmentW$peakcreat48h-AKIdevelopmentW$creat1"
"0","AKIdevelopmentW['AKIoffset']<-NA"
"0","AKIdevelopmentW['AKIstage']<-NA"
"0","#nested if else function"
"0","i <- function(if_stat, then) {"
"0","  if_stat <- lazyeval::expr_text(if_stat)"
"0","  then    <- lazyeval::expr_text(then)"
"0","  sprintf(""ifelse(%s, %s, "", if_stat, then)"
"0","}"
"0","e <- function(else_ret) {"
"0","  else_ret <- lazyeval::expr_text(else_ret)"
"0","  else_ret"
"0","}"
"0","ie <- function(...) {"
"0","  args <- list(...)"
"0","  "
"0","  for (i in 1:(length(args) - 1) ) {"
"0","      if (substr(args[[i]], 1, 6) != ""ifelse"") {"
"0","        stop(""All but the last argument, need to be i functions."", call. = FALSE)"
"0","      }"
"0","  }"
"0","  if (substr(args[[length(args)]], 1, 6) == ""ifelse""){"
"0","    stop(""Last argument needs to be an e function."", call. = FALSE)"
"0","  }"
"0","  args$final <- paste(rep(')', length(args) - 1), collapse = '')"
"0","  eval_string <- do.call('paste', args)"
"0","  eval(parse(text = eval_string))"
"0","}"
"0","AKIdevelopmentW$AKIstage <- "
"0","  ie("
"0","    i(AKIdevelopmentW$cr7undercreat1>=3,   3),"
"0","    i(AKIdevelopmentW$cr7undercreat1>=2,   2),"
"0","    i(AKIdevelopmentW$cr7undercreat1>=1.5,   1),"
"0","    i(AKIdevelopmentW$cr48hdundercreat1>=0.3,   1),"
"0","    e(0)"
"0","  )"
"0","AKIdevelopmentW$AKIoffset <- "
"0","  ie("
"0","    i(AKIdevelopmentW$cr7undercreat1>=3,AKIdevelopmentW$peakcreat7d_offset),"
"0","    i(AKIdevelopmentW$cr7undercreat1>=2,AKIdevelopmentW$peakcreat7d_offset),"
"0","    i(AKIdevelopmentW$cr7undercreat1>=1.5,AKIdevelopmentW$peakcreat7d_offset),"
"0","    i(AKIdevelopmentW$cr48hdundercreat1>=0.3,   AKIdevelopmentW$peakcreat48h_offset),"
"0","    e(0)"
"0","  )"
"0","library(dplyr)"
"0","AKIlist<-AKIdevelopmentW %>%"
"0","  select(patientunitstayid,AKIstage"
"0","         # ,AKIoffset The nephrologist suggested not to use this variable since we can not infer when AKI was developed from it. Removing it to avoid confusion."
"0","         )"
